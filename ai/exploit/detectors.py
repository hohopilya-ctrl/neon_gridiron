from typing import Any, Dict, List

import numpy as np


class ExploitLab:
    """
    Suite of detectors for common RL reward-hacking patterns.
    """

    def __init__(self):
        self.history: Dict[str, List[float]] = {}

    def detect_corner_stall(self, ball_pos: np.ndarray, tick: int) -> bool:
        # Detect if ball is stuck in corner for > N ticks
        # Corners: [0,0], [W,0], [0,H], [W,H]
        dist_to_corners = [
            np.linalg.norm(ball_pos - c) for c in [[0, 0], [60, 0], [0, 40], [60, 40]]
        ]
        if any(d < 1.5 for d in dist_to_corners):
            return True
        return False

    def detect_ability_spam(self, ability_history: List[str]) -> float:
        # Return a "spam score" based on frequency and energy cost
        if not ability_history:
            return 0.0
        return len(ability_history) / 100.0  # Placeholder logic

    def generate_report(self) -> Dict[str, Any]:
        return {"exploits_found": 0, "anomaly_level": 0.1}
