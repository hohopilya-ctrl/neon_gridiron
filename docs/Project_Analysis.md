# Анализ проекта Neon Gridiron ULTRA

## Краткий вывод

Проект выглядит как амбициозный **MVP-платформы для детерминированной спортивной симуляции + live-телеметрии + RL-обучения**, но сейчас репозиторий находится в **частично несогласованном состоянии**: архитектурные документы и часть модулей хорошо описаны, однако есть критичные разрывы между слоями (особенно `ai.env`, UI-слой и дубли серверной логики), из-за которых базовые проверки не проходят.

## Что в проекте уже хорошо

- В `docs/Architecture.md` и `sim/core/*` есть ясная доменная модель: состояние матча, физика, события, конфиги.
- Наличие строгой идеи детерминизма (seed, fixed dt, проверка повторяемости).
- Разделение на подсистемы (`sim`, `ai`, `server`, `telemetry`, `ui`) облегчает дальнейшую модульную стабилизацию.

## Критичные проблемы (блокируют работоспособность)

1. **Отсутствует модуль среды, на который завязаны тесты.**
   - Все тесты импортируют `ai.env.neon_env.NeonFootballEnv`, но директории `ai/env` в репозитории нет.
   - В результате `pytest` падает уже на стадии collection (`ModuleNotFoundError: No module named 'ai.env'`).

2. **UI-часть ссылается на отсутствующие модули.**
   - `ui/app/live/page.tsx` импортирует `../../lib/ws` и `../../lib/frame`, но в `ui/` нет папки `lib`.
   - Страница live в текущем виде не может собраться в Next.js.

3. **Дублирование и рассинхронизация серверного слоя.**
   - Есть два пути для bridge/ingest логики: `server/bridge.py` и связка `server/app.py` + `server/udp_ingest.py` + `server/ws_hub.py`.
   - Порты и семантика отличаются (`5555` в `TelemetryBridge` vs `4242` в `UDPIngest`), что повышает риск запуска «не той» цепочки.

4. **Большой технический долг по статическому качеству.**
   - `ruff check .` показывает десятки нарушений (неиспользуемые импорты, порядок импортов, undefined names, переменные без использования).
   - Есть как минимум один потенциально функциональный дефект: использование `F.mse_loss` без импорта `torch.nn.functional as F` в `ai/training/dreamer.py`.

## Наблюдения по готовности

- **Продуктовая идея и каркас:** сильные.
- **Инженерная готовность к воспроизводимому запуску:** низкая на текущем коммите.
- **Готовность к CI/CD:** низкая (базовые тесты и линт не green).

## Приоритетный план стабилизации

### P0 (сделать первым)

1. Восстановить/добавить `ai/env/neon_env.py` (или переписать тесты под фактически существующую среду).
2. Либо реализовать `ui/lib/{ws,frame}.ts`, либо удалить/заменить импорты live-страницы на реальные модули.
3. Выбрать **один** серверный путь (рекомендация: оставить `server/app.py` как canonical API entrypoint), второй пометить deprecated или удалить.

### P1

4. Привести `ruff` к нулю предупреждений как минимум в `sim`, `server`, `ai/training`.
5. Включить минимальный CI пайплайн (`ruff + pytest`) на каждый push.
6. Синхронизировать README-команды со «стабильным» запуском (какой именно скрипт поднимает полный стек).

### P2

7. Добавить smoke-тесты UI (хотя бы типовую сборку `npm run build`/`next build`).
8. Добавить contract-тест на протокол телеметрии (один формат кадра от sim до ws клиента).

## Риски, если не исправлять

- Невозможность повторяемо запускать демо/исследования.
- Расхождение командной и фактической архитектуры.
- Рост стоимости изменений из-за дублирования сервисов и нестабильного API между слоями.
